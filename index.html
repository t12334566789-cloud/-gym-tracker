<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymTracker - Твой фитнес-трекер</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body.dark-theme {
            --primary-color: #1a1a2e;
            --secondary-color: #162447;
            --accent-color: #e94560;
            --light-color: #0f3460;
            --dark-color: #1a1a2e;
            --success-color: #4ecca3;
            --warning-color: #ff9a3c;
            --card-bg: rgba(26, 26, 46, 0.95);
            --text-color: #f1f1f1;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        body {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('paint-background.jpg') center/cover fixed;
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ШАПКА */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            color: var(--accent-color);
            font-size: 28px;
        }

        .logo i {
            color: var(--secondary-color);
            font-size: 32px;
        }

        .theme-switch {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s;
        }

        .theme-switch:hover {
            transform: scale(1.05);
        }

        /* ОСНОВНОЙ КОНТЕНТ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        /* КАРТОЧКИ */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        .card h2 i {
            color: var(--accent-color);
        }

        /* ПРОФИЛЬ */
        .profile-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            color: #333;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
        }

        .bmi-result {
            background: var(--light-color);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }

        /* КАЛЕНДАРЬ */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: var(--light-color);
            border-radius: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .calendar-day:hover {
            background: var(--secondary-color);
            color: white;
        }

        .calendar-day.trained {
            background: var(--success-color);
            color: white;
        }

        .calendar-day.rest-day {
            background: var(--accent-color);
            color: white;
        }

        /* ЦЕЛИ */
        .goal-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--light-color);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .goal-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* ДРУЗЬЯ */
        .friend-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--light-color);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            background: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        /* ЭКРАН ВХОДА */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), url('paint-background.jpg') center/cover;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-box {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .user-id-display {
            background: var(--light-color);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-color);
            letter-spacing: 2px;
        }

        .instructions {
            background: var(--light-color);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        /* АДАПТИВНОСТЬ */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .profile-info {
                grid-template-columns: 1fr;
            }
            
            .calendar {
                grid-template-columns: repeat(4, 1fr);
            }
            
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="logo">
                <i class="fas fa-dumbbell"></i>
                <h1>GymTracker</h1>
            </div>
            
            <h2>Вход в систему</h2>
            
            <div class="input-group">
                <label for="emailInput"><i class="fas fa-envelope"></i> Введите ваш email:</label>
                <input type="email" id="emailInput" placeholder="ваш@email.com">
            </div>
            
            <button onclick="loginByEmail()" style="width: 100%;">
                <i class="fas fa-sign-in-alt"></i> Войти / Зарегистрироваться
            </button>
            
            <div id="userIdDisplay" class="user-id-display" style="display: none;">
                Ваш ID: <span id="userIdValue"></span>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Как это работает:</h3>
                <p>1. Введите ваш email</p>
                <p>2. Вы получите уникальный ID (например: GYM-7A3B)</p>
                <p>3. Этот ID нужен для поиска друзей</p>
                <p>4. Все данные сохранятся автоматически</p>
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <!-- ШАПКА -->
        <header>
            <div class="logo">
                <i class="fas fa-dumbbell"></i>
                <h1>GymTracker</h1>
            </div>
            
            <div style="display: flex; gap: 15px; align-items: center;">
                <div id="currentUserId" style="background: var(--light-color); padding: 10px 15px; border-radius: 8px; font-weight: bold;">
                    ID: <span id="userDisplayId"></span>
                </div>
                <button class="theme-switch" onclick="toggleTheme()">
                    <i class="fas fa-palette"></i> Сменить тему
                </button>
            </div>
        </header>

        <!-- ОСНОВНОЙ КОНТЕНТ -->
        <div class="main-content">
            <!-- ЛЕВАЯ КОЛОНКА -->
            <div class="left-column">
                <!-- ПРОФИЛЬ -->
                <div class="card">
                    <h2><i class="fas fa-user"></i> Мой профиль</h2>
                    <div class="profile-info">
                        <div>
                            <div class="input-group">
                                <label for="userEmail">Email:</label>
                                <input type="email" id="userEmail" disabled>
                            </div>
                            
                            <div class="input-group">
                                <label for="userName">Имя:</label>
                                <input type="text" id="userName" placeholder="Ваше имя">
                            </div>
                            
                            <div class="input-group">
                                <label for="userAge">Возраст:</label>
                                <input type="number" id="userAge" placeholder="Возраст">
                            </div>
                        </div>
                        
                        <div>
                            <div class="input-group">
                                <label for="userHeight">Рост (см):</label>
                                <input type="number" id="userHeight" placeholder="Рост в см">
                            </div>
                            
                            <div class="input-group">
                                <label for="userWeight">Вес (кг):</label>
                                <input type="number" id="userWeight" placeholder="Вес в кг">
                            </div>
                            
                            <button onclick="calculateBMI()">
                                <i class="fas fa-calculator"></i> Рассчитать ИМТ
                            </button>
                            
                            <div id="bmiResult" class="bmi-result">
                                ИМТ: -- | Категория: --
                            </div>
                        </div>
                    </div>
                    <button onclick="saveProfile()" style="margin-top: 15px;">
                        <i class="fas fa-save"></i> Сохранить профиль
                    </button>
                </div>

                <!-- КАЛЕНДАРЬ ТРЕНИРОВОК -->
                <div class="card">
                    <h2><i class="fas fa-calendar-alt"></i> Календарь тренировок</h2>
                    <p>Кликните на день, чтобы отметить тренировку</p>
                    
                    <div class="calendar" id="calendar">
                        <!-- Дни календаря будут здесь -->
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="markAsTrained()">
                            <i class="fas fa-dumbbell"></i> Тренировался
                        </button>
                        <button onclick="markAsRest()" style="background: var(--accent-color);">
                            <i class="fas fa-bed"></i> Отдыхал
                        </button>
                        <button onclick="clearCalendar()" style="background: var(--warning-color);">
                            <i class="fas fa-trash"></i> Очистить
                        </button>
                    </div>
                </div>

                <!-- ДНЕВНИК ПРОГРЕССА -->
                <div class="card">
                    <h2><i class="fas fa-book"></i> Дневник тренировок</h2>
                    <div class="input-group">
                        <label for="workoutNotes">Заметки о сегодняшней тренировке:</label>
                        <textarea id="workoutNotes" rows="4" placeholder="Что делал, как самочувствие, результаты..."></textarea>
                    </div>
                    <button onclick="saveWorkoutNotes()">
                        <i class="fas fa-save"></i> Сохранить заметки
                    </button>
                    
                    <div id="savedNotes" style="margin-top: 20px;">
                        <!-- Заметки будут здесь -->
                    </div>
                </div>
            </div>

            <!-- ПРАВАЯ КОЛОНКА -->
            <div class="right-column">
                <!-- МОИ ЦЕЛИ -->
                <div class="card">
                    <h2><i class="fas fa-flag-checkered"></i> Мои цели</h2>
                    <div id="goalsList">
                        <!-- Цели будут здесь -->
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="text" id="newGoal" placeholder="Новая цель">
                        <button onclick="addGoal()">
                            <i class="fas fa-plus"></i> Добавить
                        </button>
                    </div>
                </div>

                <!-- МОИ ДРУЗЬЯ -->
                <div class="card">
                    <h2><i class="fas fa-users"></i> Мои друзья</h2>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="text" id="friendIdInput" placeholder="Введите ID друга">
                        <button onclick="addFriendById()">
                            <i class="fas fa-search"></i> Найти
                        </button>
                    </div>
                    
                    <div id="friendsList">
                        <!-- Друзья будут здесь -->
                    </div>
                </div>

                <!-- СТАТИСТИКА -->
                <div class="card">
                    <h2><i class="fas fa-chart-line"></i> Статистика</h2>
                    <div id="statsContent">
                        <p>Тренировок в этом месяце: <span id="workoutsCount">0</span></p>
                        <p>Выполнено целей: <span id="goalsCompleted">0</span> / <span id="goalsTotal">0</span></p>
                        <p>Друзей в сети: <span id="friendsCount">0</span></p>
                    </div>
                </div>

                <!-- ИНСТРУКЦИЯ -->
                <div class="card">
                    <h2><i class="fas fa-question-circle"></i> Как пользоваться</h2>
                    <div class="instructions">
                        <p><strong>Ваш ID:</strong> покажите друзьям для добавления</p>
                        <p><strong>Добавить друга:</strong> введите его ID в поле выше</p>
                        <p><strong>Календарь:</strong> кликайте на дни тренировок</p>
                        <p><strong>ИМТ:</strong> введите рост/вес и нажмите "Рассчитать"</p>
                        <p><strong>Все данные сохраняются автоматически</strong></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ====================
        let currentUser = null;
        let allUsers = {};
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // ==================== ИНИЦИАЛИЗАЦИЯ ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Загружаем сохранённых пользователей
            loadAllUsers();
            
            // Проверяем, есть ли активная сессия
            checkActiveSession();
            
            // Показываем экран входа
            showLoginScreen();
        });

        // ==================== СИСТЕМА EMAIL/ID ====================
        
        // Генерация уникального ID формата GYM-XXXX
        function generateUserId() {
            const chars = '0123456789ABCDEF';
            let id = 'GYM-';
            for (let i = 0; i < 4; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return id;
        }

        // Поиск пользователя по email
        function findUserByEmail(email) {
            return allUsers[email];
        }

        // Вход по email
        function loginByEmail() {
            const emailInput = document.getElementById('emailInput');
            const email = emailInput.value.trim().toLowerCase();
            
            if (!email) {
                alert('Пожалуйста, введите email');
                return;
            }
            
            // Проверяем формат email (простая проверка)
            if (!email.includes('@') || !email.includes('.')) {
                alert('Пожалуйста, введите корректный email');
                return;
            }
            
            let user = findUserByEmail(email);
            
            if (!user) {
                // Создаём нового пользователя
                user = {
                    email: email,
                    id: generateUserId(),
                    name: '',
                    age: '',
                    height: '',
                    weight: '',
                    bmi: null,
                    bmiCategory: '',
                    goals: [
                        {text: 'Тренироваться 3 раза в неделю', completed: false},
                        {text: 'Пить 2 литра воды в день', completed: false},
                        {text: 'Спать 8 часов в сутки', completed: false}
                    ],
                    friends: [],
                    calendar: {},
                    workoutNotes: {},
                    theme: 'light'
                };
                
                allUsers[email] = user;
                saveAllUsers();
                
                // Показываем ID нового пользователя
                document.getElementById('userIdValue').textContent = user.id;
                document.getElementById('userIdDisplay').style.display = 'block';
                
                alert(`Добро пожаловать! Ваш уникальный ID: ${user.id}\nЗапомните его для добавления друзей!`);
            } else {
                // Показываем ID существующего пользователя
                document.getElementById('userIdValue').textContent = user.id;
                document.getElementById('userIdDisplay').style.display = 'block';
            }
            
            // Устанавливаем текущего пользователя
            currentUser = user;
            
            // Сохраняем активную сессию
            localStorage.setItem('currentUserEmail', email);
            
            // Прячем экран входа и показываем основное приложение
            setTimeout(() => {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Загружаем данные пользователя
                loadUserData();
                
                // Устанавливаем тему
                if (user.theme === 'dark') {
                    document.body.classList.add('dark-theme');
                }
            }, 1000);
        }

        // ==================== УПРАВЛЕНИЕ ДАННЫМИ ====================
        
        function saveAllUsers() {
            localStorage.setItem('gymTrackerUsers', JSON.stringify(allUsers));
        }

        function loadAllUsers() {
            const saved = localStorage.getItem('gymTrackerUsers');
            if (saved) {
                allUsers = JSON.parse(saved);
            }
        }

        function checkActiveSession() {
            const savedEmail = localStorage.getItem('currentUserEmail');
            if (savedEmail && allUsers[savedEmail]) {
                currentUser = allUsers[savedEmail];
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                loadUserData();
                
                if (currentUser.theme === 'dark') {
                    document.body.classList.add('dark-theme');
                }
            }
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            
            // Очищаем поле email при показе экрана входа
            document.getElementById('emailInput').value = '';
            document.getElementById('userIdDisplay').style.display = 'none';
        }

        // ==================== ЗАГРУЗКА ДАННЫХ ПОЛЬЗОВАТЕЛЯ ====================
        
        function loadUserData() {
            if (!currentUser) return;
            
            // Заполняем профиль
            document.getElementById('userEmail').value = currentUser.email;
            document.getElementById('userName').value = currentUser.name || '';
            document.getElementById('userAge').value = currentUser.age || '';
            document.getElementById('userHeight').value = currentUser.height || '';
            document.getElementById('userWeight').value = currentUser.weight || '';
            
            // Показываем ID
            document.getElementById('userDisplayId').textContent = currentUser.id;
            
            // Загружаем ИМТ если есть
            if (currentUser.bmi) {
                document.getElementById('bmiResult').innerHTML = `
                    ИМТ: ${currentUser.bmi.toFixed(1)} | Категория: ${currentUser.bmiCategory}
                `;
            }
            
            // Загружаем цели
            loadGoals();
            
            // Загружаем друзей
            loadFriends();
            
            // Загружаем календарь
            generateCalendar();
            
            // Загружаем заметки
            loadWorkoutNotes();
            
            // Обновляем статистику
            updateStats();
        }

        // ==================== ПРОФИЛЬ И ИМТ ====================
        
        function saveProfile() {
            if (!currentUser) return;
            
            currentUser.name = document.getElementById('userName').value;
            currentUser.age = document.getElementById('userAge').value;
            currentUser.height = document.getElementById('userHeight').value;
            currentUser.weight = document.getElementById('userWeight').value;
            
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            
            alert('Профиль сохранён!');
        }

        function calculateBMI() {
            const height = parseFloat(document.getElementById('userHeight').value);
            const weight = parseFloat(document.getElementById('userWeight').value);
            
            if (!height || !weight) {
                alert('Пожалуйста, введите рост и вес');
                return;
            }
            
            // Переводим рост в метры
            const heightInMeters = height / 100;
            
            // Рассчитываем ИМТ
            const bmi = weight / (heightInMeters * heightInMeters);
            
            // Определяем категорию
            let category = '';
            if (bmi < 18.5) category = 'Недостаточный вес';
            else if (bmi < 25) category = 'Нормальный вес';
            else if (bmi < 30) category = 'Избыточный вес';
            else category = 'Ожирение';
            
            // Сохраняем в профиле
            currentUser.bmi = bmi;
            currentUser.bmiCategory = category;
            
            // Показываем результат
            document.getElementById('bmiResult').innerHTML = `
                ИМТ: ${bmi.toFixed(1)} | Категория: ${category}
            `;
            
            // Сохраняем
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
        }

        // ==================== СИСТЕМА ЦЕЛЕЙ ====================
        
        function loadGoals() {
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';
            
            if (!currentUser.goals) {
                currentUser.goals = [];
            }
            
            currentUser.goals.forEach((goal, index) => {
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';
                goalItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" class="goal-checkbox" ${goal.completed ? 'checked' : ''} 
                               onchange="toggleGoal(${index})">
                        <span style="${goal.completed ? 'text-decoration: line-through; opacity: 0.7;' : ''}">
                            ${goal.text}
                        </span>
                    </div>
                    <button onclick="removeGoal(${index})" style="background: var(--accent-color); padding: 5px 10px;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                goalsList.appendChild(goalItem);
            });
            
            updateStats();
        }

        function addGoal() {
            const newGoalInput = document.getElementById('newGoal');
            const goalText = newGoalInput.value.trim();
            
            if (!goalText) {
                alert('Введите текст цели');
                return;
            }
            
            if (!currentUser.goals) {
                currentUser.goals = [];
            }
            
            currentUser.goals.push({
                text: goalText,
                completed: false
            });
            
            newGoalInput.value = '';
            
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            loadGoals();
        }

        function toggleGoal(index) {
            currentUser.goals[index].completed = !currentUser.goals[index].completed;
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            loadGoals();
        }

        function removeGoal(index) {
            currentUser.goals.splice(index, 1);
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            loadGoals();
        }

        // ==================== СИСТЕМА ДРУЗЕЙ ====================
        
        function loadFriends() {
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            if (!currentUser.friends || currentUser.friends.length === 0) {
                friendsList.innerHTML = '<p style="text-align: center; padding: 20px;">У вас пока нет друзей</p>';
                return;
            }
            
            currentUser.friends.forEach((friend, index) => {
                const friendCard = document.createElement('div');
                friendCard.className = 'friend-card';
                friendCard.innerHTML = `
                    <div class="friend-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div style="flex-grow: 1;">
                        <h3>${friend.name || 'Без имени'}</h3>
                        <p>ID: ${friend.id}</p>
                        <p>${friend.email}</p>
                    </div>
                    <button onclick="removeFriend(${index})" style="background: var(--accent-color);">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                friendsList.appendChild(friendCard);
            });
            
            updateStats();
        }

        // Поиск друга по ID
        function findFriendById(friendId) {
            friendId = friendId.trim().toUpperCase();
            
            // Ищем во всех пользователях
            for (const email in allUsers) {
                if (allUsers[email].id === friendId) {
                    return allUsers[email];
                }
            }
            return null;
        }

        function addFriendById() {
            const friendIdInput = document.getElementById('friendIdInput');
            const friendId = friendIdInput.value.trim().toUpperCase();
            
            if (!friendId) {
                alert('Введите ID друга');
                return;
            }
            
            // Проверяем формат ID
            if (!friendId.startsWith('GYM-') || friendId.length !== 8) {
                alert('ID должен быть в формате GYM-XXXX (например: GYM-7A3B)');
                return;
            }
            
            // Нельзя добавить самого себя
            if (friendId === currentUser.id) {
                alert('Нельзя добавить самого себя в друзья');
                return;
            }
            
            // Ищем друга
            const friend = findFriendById(friendId);
            
            if (!friend) {
                alert('Пользователь с таким ID не найден');
                return;
            }
            
            // Проверяем, не добавлен ли уже
            if (currentUser.friends) {
                const alreadyAdded = currentUser.friends.find(f => f.id === friendId);
                if (alreadyAdded) {
                    alert('Этот пользователь уже в вашем списке друзей');
                    return;
                }
            }
            
            // Добавляем друга
            if (!currentUser.friends) {
                currentUser.friends = [];
            }
            
            currentUser.friends.push({
                id: friend.id,
                email: friend.email,
                name: friend.name || 'Без имени'
            });
            
            friendIdInput.value = '';
            
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            loadFriends();
            
            alert(`Друг ${friend.name || friend.email} добавлен!`);
        }

        function removeFriend(index) {
            currentUser.friends.splice(index, 1);
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            loadFriends();
        }

        // ==================== КАЛЕНДАРЬ ТРЕНИРОВОК ====================
        
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            // Заголовки дней недели
            const days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-header';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Получаем первый день месяца
            const firstDay = new Date(currentYear, currentMonth, 1);
            const startingDay = firstDay.getDay(); // 0 - воскресенье, 1 - понедельник
            
            // Корректируем для нашего календаря (понедельник - первый день)
            let startingIndex = startingDay === 0 ? 6 : startingDay - 1;
            
            // Добавляем пустые ячейки для начала месяца
            for (let i = 0; i < startingIndex; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendar.appendChild(emptyDay);
            }
            
            // Получаем количество дней в месяце
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Создаем ячейки для дней месяца
            const today = new Date();
            const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
            
            // Инициализируем календарь если нужно
            if (!currentUser.calendar) {
                currentUser.calendar = {};
            }
            
            // Создаем ключ для текущего месяца (формат: ГГГГ-ММ)
            const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            
            if (!currentUser.calendar[monthKey]) {
                currentUser.calendar[monthKey] = {};
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Проверяем, есть ли отметка для этого дня
                const dayKey = String(day).padStart(2, '0');
                const dayStatus = currentUser.calendar[monthKey][dayKey];
                
                if (dayStatus === 'trained') {
                    dayElement.classList.add('trained');
                } else if (dayStatus === 'rest') {
                    dayElement.classList.add('rest-day');
                }
                
                // Выделяем сегодняшний день
                if (isCurrentMonth && day === today.getDate()) {
                    dayElement.style.border = '3px solid var(--accent-color)';
                }
                
                // Добавляем обработчик клика
                dayElement.onclick = () => toggleDayStatus(day);
                
                calendar.appendChild(dayElement);
            }
            
            updateStats();
        }

        function toggleDayStatus(day) {
            if (!currentUser.calendar) {
                currentUser.calendar = {};
            }
            
            const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            const dayKey = String(day).padStart(2, '0');
            
            if (!currentUser.calendar[monthKey]) {
                currentUser.calendar[monthKey] = {};
            }
            
            // Переключаем статус: trained → rest → none
            const currentStatus = currentUser.calendar[monthKey][dayKey];
            
            if (!currentStatus || currentStatus === 'none') {
                currentUser.calendar[monthKey][dayKey] = 'trained';
            } else if (currentStatus === 'trained') {
                currentUser.calendar[monthKey][dayKey] = 'rest';
            } else {
                currentUser.calendar[monthKey][dayKey] = 'none';
            }
            
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            generateCalendar();
        }

        function markAsTrained() {
            const today = new Date();
            if (today.getMonth() === currentMonth && today.getFullYear() === currentYear) {
                toggleDayStatus(today.getDate());
            } else {
                alert('Сегодняшний день не в текущем месяце календаря');
            }
        }

        function markAsRest() {
            const today = new Date();
            if (today.getMonth() === currentMonth && today.getFullYear() === currentYear) {
                const day = today.getDate();
                const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
                const dayKey = String(day).padStart(2, '0');
                
                if (!currentUser.calendar) currentUser.calendar = {};
                if (!currentUser.calendar[monthKey]) currentUser.calendar[monthKey] = {};
                
                currentUser.calendar[monthKey][dayKey] = 'rest';
                
                allUsers[currentUser.email] = currentUser;
                saveAllUsers();
                generateCalendar();
            }
        }

        function clearCalendar() {
            if (confirm('Вы уверены, что хотите очистить календарь на этот месяц?')) {
                const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
                currentUser.calendar[monthKey] = {};
                
                allUsers[currentUser.email] = currentUser;
                saveAllUsers();
                generateCalendar();
            }
        }

        // ==================== ДНЕВНИК ТРЕНИРОВОК ====================
        
        function loadWorkoutNotes() {
            const savedNotes = document.getElementById('savedNotes');
            savedNotes.innerHTML = '';
            
            if (!currentUser.workoutNotes) {
                currentUser.workoutNotes = {};
                return;
            }
            
            // Показываем последние 5 заметок
            const notes = Object.entries(currentUser.workoutNotes)
                .sort((a, b) => b[0].localeCompare(a[0])) // Сортируем по дате (новые сначала)
                .slice(0, 5);
            
            if (notes.length === 0) {
                savedNotes.innerHTML = '<p>Заметок пока нет</p>';
                return;
            }
            
            notes.forEach(([date, note]) => {
                const noteElement = document.createElement('div');
                noteElement.className = 'goal-item';
                noteElement.style.marginTop = '10px';
                noteElement.innerHTML = `
                    <div>
                        <strong>${formatDate(date)}</strong>
                        <p>${note}</p>
                    </div>
                    <button onclick="deleteNote('${date}')" style="background: var(--accent-color); padding: 5px 10px;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                savedNotes.appendChild(noteElement);
            });
        }

        function saveWorkoutNotes() {
            const notesInput = document.getElementById('workoutNotes');
            const notes = notesInput.value.trim();
            
            if (!notes) {
                alert('Введите заметки о тренировке');
                return;
            }
            
            if (!currentUser.workoutNotes) {
                currentUser.workoutNotes = {};
            }
            
            // Сохраняем с текущей датой
            const today = new Date().toISOString().split('T')[0]; // Формат ГГГГ-ММ-ДД
            currentUser.workoutNotes[today] = notes;
            
            notesInput.value = '';
            
            allUsers[currentUser.email] = currentUser;
            saveAllUsers();
            loadWorkoutNotes();
            
            alert('Заметки сохранены!');
        }

        function deleteNote(date) {
            if (confirm('Удалить эту заметку?')) {
                delete currentUser.workoutNotes[date];
                allUsers[currentUser.email] = currentUser;
                saveAllUsers();
                loadWorkoutNotes();
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // ==================== ТЕМЫ ====================
        
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            
            if (currentUser) {
                currentUser.theme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
                allUsers[currentUser.email] = currentUser;
                saveAllUsers();
            }
        }

        // ==================== СТАТИСТИКА ====================
        
        function updateStats() {
            if (!currentUser) return;
            
            // Считаем тренировки в текущем месяце
            let workoutsCount = 0;
            const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            
            if (currentUser.calendar && currentUser.calendar[monthKey]) {
                workoutsCount = Object.values(currentUser.calendar[monthKey]).filter(
                    status => status === 'trained'
                ).length;
            }
            
            // Считаем цели
            const goalsTotal = currentUser.goals ? currentUser.goals.length : 0;
            const goalsCompleted = currentUser.goals ? 
                currentUser.goals.filter(goal => goal.completed).length : 0;
            
            // Считаем друзей
            const friendsCount = currentUser.friends ? currentUser.friends.length : 0;
            
            // Обновляем отображение
            document.getElementById('workoutsCount').textContent = workoutsCount;
            document.getElementById('goalsTotal').textContent = goalsTotal;
            document.getElementById('goalsCompleted').textContent = goalsCompleted;
            document.getElementById('friendsCount').textContent = friendsCount;
        }

        // ==================== ВЫХОД ====================
        
        function logout() {
            if (confirm('Выйти из аккаунта?')) {
                localStorage.removeItem('currentUserEmail');
                currentUser = null;
                showLoginScreen();
            }
        }

        // Добавляем кнопку выхода в шапку
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('header .logo');
            if (header) {
                const logoutBtn = document.createElement('button');
                logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Выйти';
                logoutBtn.style.background = 'var(--accent-color)';
                logoutBtn.onclick = logout;
                header.appendChild(logoutBtn);
            }
        });
    </script>
</body>
</html>
